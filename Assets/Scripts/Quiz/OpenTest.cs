using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityStandardAssets.Characters.FirstPerson;
using TMPro;

public class OpenTest : MonoBehaviour
{

    public GameObject panel;
    public GameObject panel2;
    public GameObject thePlayer;
    public bool isPlayer;
    public bool isOpen = true;
    public bool isPassed = false;

    public Camera FPSController;
    public Camera QuizCamera;
    private SaveScore saveScore;
    private CamPosSav CamPosSav;
    private UIController UIC;
    public bool isClicked = false;
    public int numberOfQuiz;

    QuizController quizController;

    private void Start()
    {
        UIC = FindObjectOfType<UIController>();
        saveScore = FindObjectOfType<SaveScore>();
        quizController = FindObjectOfType<QuizController>();
    }

    private void Update()
    {
       
    }

    private void OnTriggerStay(Collider other)
    {
        if (other.tag.Equals("Player"))
        {
            isPlayer = true;
            
            if (Input.GetKeyDown(KeyCode.E) && isOpen)
            {
                QuizCamera.enabled = true;
                quizController.PresentQuestion(numberOfQuiz);
                CamPosSav.MyCamPos = FPSController.transform.position; 
                panel.gameObject.SetActive(true);
                QuizCamera.transform.position = CamPosSav.MyCamPos;
                Cursor.visible = true;
                thePlayer.SetActive(false);
                isOpen = false;  
            }
            if(Input.GetKeyDown(KeyCode.Y) && isPassed)
            {
                isOpen = true;
                isPassed = false;
            }

        }

    }

    void OnTriggerExit(Collider other)
    {
        if (other.tag.Equals("Player"))
        {
            isPlayer = false;
            isPassed = true;
            saveScore.SaveStats(numberOfQuiz);
            UIC.ResetPlayerStats();
            UIC.ResetScoreGUI();
        }
    }

    private void OnGUI()
    {
        GUI.contentColor = Color.red;
        if (isPlayer && isOpen)
            GUI.Label(new Rect(Screen.width / 2 - 50, Screen.height / 2 - 60, 150, 50), "Naciśnij E, aby rozpocząć Quiz");
       else if(isPlayer&&isPassed)
           GUI.Label(new Rect(Screen.width / 2 - 50, Screen.height / 2 - 60, 150, 50), "Quiz Zakończony, wciśnij Y aby podejść do niego ponownie");
       
    }

  
}

